<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Savvy Realty | VA Training Assessment</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
<style>
  :root {
    --sky:#4ABDE8; --sky-light:#D6F0FA; --sky-dark:#2896C8;
    --black:#0F1114; --gray-dark:#2C3039; --gray-mid:#6B7280;
    --gray-light:#E8EDF2; --white:#FFFFFF;
    --green:#22C55E; --red:#EF4444; --gold:#F59E0B;
    --radius:12px; --shadow:0 4px 24px rgba(15,17,20,0.10);
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'DM Sans',sans-serif;background:#F0F6FA;color:var(--black);min-height:100vh;}

  /* HEADER */
  .site-header{background:var(--black);padding:0 40px;display:flex;align-items:center;
    justify-content:space-between;height:64px;position:sticky;top:0;z-index:100;
    box-shadow:0 2px 12px rgba(0,0,0,0.3);}
  .logo{font-family:'DM Serif Display',serif;font-size:22px;color:var(--white);}
  .logo span{color:var(--sky);}
  .header-right{display:flex;align-items:center;gap:12px;}
  .header-badge{font-size:12px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;
    color:var(--sky);border:1px solid var(--sky-dark);border-radius:20px;padding:4px 14px;}
  .admin-link{font-size:12px;font-weight:600;color:rgba(255,255,255,0.4);background:none;border:none;
    cursor:pointer;font-family:'DM Sans',sans-serif;letter-spacing:0.04em;transition:color .2s;padding:4px 8px;}
  .admin-link:hover{color:var(--sky);}

  /* SETUP BANNER â€” shown when script URL not configured */
  .setup-banner{background:#FEF3C7;border-bottom:2px solid var(--gold);padding:14px 40px;
    display:flex;align-items:center;gap:14px;font-size:14px;color:#92400E;}
  .setup-banner strong{font-weight:700;}
  .setup-banner a{color:var(--sky-dark);font-weight:600;cursor:pointer;text-decoration:underline;}
  .setup-banner .icon{font-size:20px;flex-shrink:0;}

  /* WRAPPER */
  .wrapper{max-width:820px;margin:0 auto;padding:40px 20px 80px;}

  /* SCREENS */
  .screen{display:none;}
  .screen.active{display:block;animation:fadeSlide .4s ease both;}
  @keyframes fadeSlide{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:none;}}

  /* INTRO */
  .intro-hero{background:var(--black);border-radius:20px;padding:56px 48px;color:var(--white);
    margin-bottom:28px;position:relative;overflow:hidden;}
  .intro-hero::before{content:'';position:absolute;top:-60px;right:-60px;width:260px;height:260px;
    border-radius:50%;background:radial-gradient(circle,rgba(74,189,232,0.18),transparent 70%);}
  .intro-hero h1{font-family:'DM Serif Display',serif;font-size:36px;line-height:1.2;margin-bottom:16px;}
  .intro-hero h1 em{color:var(--sky);font-style:normal;}
  .intro-hero p{font-size:16px;color:rgba(255,255,255,0.72);line-height:1.7;max-width:520px;margin-bottom:32px;}
  .intro-meta{display:flex;gap:16px;flex-wrap:wrap;}
  .meta-chip{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.14);border-radius:8px;padding:10px 16px;font-size:13px;font-weight:500;}

  .name-card{background:var(--white);border-radius:var(--radius);padding:32px 36px;box-shadow:var(--shadow);margin-bottom:24px;}
  .name-card label{display:block;font-weight:600;font-size:13px;text-transform:uppercase;
    letter-spacing:0.06em;color:var(--gray-mid);margin-bottom:10px;}
  .field-input{width:100%;border:2px solid var(--gray-light);border-radius:8px;padding:14px 16px;
    font-size:16px;font-family:'DM Sans',sans-serif;transition:border-color .2s;outline:none;}
  .field-input:focus{border-color:var(--sky);}

  /* PROGRESS */
  .progress-bar-wrap{background:var(--white);border-radius:100px;height:6px;margin-bottom:28px;overflow:hidden;}
  .progress-bar-fill{height:100%;background:linear-gradient(90deg,var(--sky-dark),var(--sky));border-radius:100px;transition:width .5s cubic-bezier(.4,0,.2,1);}
  .progress-label{display:flex;justify-content:space-between;font-size:13px;color:var(--gray-mid);margin-bottom:12px;}

  /* SECTION DIVIDER */
  .section-divider{display:flex;align-items:center;gap:14px;margin:36px 0 20px;}
  .section-divider-label{background:var(--black);color:var(--white);font-size:11px;font-weight:700;
    letter-spacing:0.1em;text-transform:uppercase;padding:5px 14px;border-radius:20px;white-space:nowrap;}
  .section-divider-label.accent{background:var(--sky-dark);}
  .section-divider-line{flex:1;height:1px;background:var(--gray-light);}

  /* QUESTION CARD */
  .q-card{background:var(--white);border-radius:var(--radius);padding:28px 32px;margin-bottom:18px;
    box-shadow:var(--shadow);border:2px solid transparent;transition:border-color .2s;}
  .q-card.answered{border-color:var(--sky-light);}
  .q-card.correct{border-color:#BBF7D0;background:#F0FDF4;}
  .q-card.incorrect{border-color:#FECACA;background:#FFF5F5;}
  .q-number{font-size:11px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--sky-dark);margin-bottom:10px;}
  .q-text{font-size:16px;font-weight:500;line-height:1.6;color:var(--black);margin-bottom:20px;}
  .q-text .highlight{background:var(--sky-light);border-radius:4px;padding:1px 6px;}

  /* MC */
  .options-grid{display:flex;flex-direction:column;gap:10px;}
  .option-btn{display:flex;align-items:center;gap:14px;padding:14px 18px;border:2px solid var(--gray-light);
    border-radius:10px;background:var(--white);cursor:pointer;font-family:'DM Sans',sans-serif;
    font-size:15px;text-align:left;transition:all .18s;}
  .option-btn:hover:not(:disabled){border-color:var(--sky);background:var(--sky-light);}
  .option-btn.selected{border-color:var(--sky-dark);background:var(--sky-light);font-weight:600;}
  .option-btn.correct-ans{border-color:var(--green);background:#F0FDF4;color:#15803D;font-weight:600;}
  .option-btn.wrong-ans{border-color:var(--red);background:#FFF5F5;color:#B91C1C;text-decoration:line-through;}
  .option-btn:disabled{cursor:default;}
  .option-letter{width:30px;height:30px;border-radius:50%;background:var(--gray-light);display:flex;
    align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0;transition:background .18s;}
  .option-btn.selected .option-letter{background:var(--sky-dark);color:white;}
  .option-btn.correct-ans .option-letter{background:var(--green);color:white;}
  .option-btn.wrong-ans .option-letter{background:var(--red);color:white;}

  /* T/F */
  .tf-grid{display:flex;gap:12px;}
  .tf-btn{flex:1;padding:16px;border:2px solid var(--gray-light);border-radius:10px;background:var(--white);
    cursor:pointer;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;transition:all .18s;text-align:center;}
  .tf-btn:hover:not(:disabled){border-color:var(--sky);background:var(--sky-light);}
  .tf-btn.selected{border-color:var(--sky-dark);background:var(--sky-light);color:var(--sky-dark);}
  .tf-btn.correct-ans{border-color:var(--green);background:#F0FDF4;color:#15803D;}
  .tf-btn.wrong-ans{border-color:var(--red);background:#FFF5F5;color:#B91C1C;}
  .tf-btn:disabled{cursor:default;}

  /* FILL */
  .fill-input{width:100%;border:2px solid var(--gray-light);border-radius:10px;padding:14px 16px;
    font-size:15px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s;}
  .fill-input:focus{border-color:var(--sky);}
  .fill-input.correct{border-color:var(--green);background:#F0FDF4;}
  .fill-input.incorrect{border-color:var(--red);background:#FFF5F5;}

  /* WRITTEN */
  .written-area{width:100%;border:2px solid var(--gray-light);border-radius:10px;padding:14px 16px;
    font-size:15px;font-family:'DM Sans',sans-serif;min-height:120px;resize:vertical;outline:none;
    transition:border-color .2s;line-height:1.6;}
  .written-area:focus{border-color:var(--sky);}
  .written-label{font-size:12px;color:var(--sky-dark);font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px;}
  .badge-manual{background:var(--sky-light);color:var(--sky-dark);font-size:11px;font-weight:700;
    letter-spacing:0.06em;text-transform:uppercase;border-radius:20px;padding:2px 10px;}

  /* FEEDBACK */
  .q-feedback{margin-top:14px;padding:12px 16px;border-radius:8px;font-size:14px;line-height:1.6;display:none;}
  .q-feedback.show{display:block;}
  .q-feedback.correct-fb{background:#DCFCE7;color:#166534;border-left:4px solid var(--green);}
  .q-feedback.incorrect-fb{background:#FEE2E2;color:#991B1B;border-left:4px solid var(--red);}

  /* BUTTONS */
  .check-btn{margin-top:16px;padding:11px 24px;background:var(--sky-dark);color:white;border:none;
    border-radius:8px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:background .2s,transform .1s;}
  .check-btn:hover{background:#1e7dab;}
  .check-btn:active{transform:scale(0.97);}
  .check-btn:disabled{background:var(--gray-mid);cursor:default;}
  .submit-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--sky-dark),var(--sky));
    color:white;border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:17px;
    font-weight:700;cursor:pointer;transition:opacity .2s,transform .1s;
    box-shadow:0 4px 20px rgba(74,189,232,0.35);margin-top:32px;letter-spacing:0.02em;}
  .submit-btn:hover{opacity:0.92;}
  .submit-btn:active{transform:scale(0.98);}
  .btn-primary{padding:14px 32px;background:var(--black);color:white;border:none;border-radius:10px;
    font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:background .2s;}
  .btn-primary:hover{background:var(--gray-dark);}

  /* RESULTS */
  .result-hero{background:var(--black);border-radius:20px;padding:48px;color:white;margin-bottom:28px;
    text-align:center;position:relative;overflow:hidden;}
  .result-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(74,189,232,0.2) 0%,transparent 70%);}
  .score-ring{width:140px;height:140px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    margin:0 auto 24px;position:relative;z-index:1;}
  .score-inner{width:110px;height:110px;border-radius:50%;background:var(--black);display:flex;
    flex-direction:column;align-items:center;justify-content:center;}
  .score-pct{font-family:'DM Serif Display',serif;font-size:34px;color:white;line-height:1;}
  .score-sub{font-size:12px;color:rgba(255,255,255,0.5);}
  .result-hero h2{font-family:'DM Serif Display',serif;font-size:28px;margin-bottom:10px;position:relative;z-index:1;}
  .result-hero p{color:rgba(255,255,255,0.65);font-size:15px;position:relative;z-index:1;}

  .stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:28px;}
  .stat-card{background:var(--white);border-radius:var(--radius);padding:20px;text-align:center;box-shadow:var(--shadow);}
  .stat-card .val{font-family:'DM Serif Display',serif;font-size:32px;line-height:1;margin-bottom:6px;}
  .stat-card .lbl{font-size:13px;color:var(--gray-mid);font-weight:500;}
  .stat-card.green .val{color:var(--green);}
  .stat-card.red .val{color:var(--red);}
  .stat-card.gold .val{color:var(--gold);}

  /* GRADING */
  .grading-section{background:var(--white);border-radius:var(--radius);padding:28px 32px;box-shadow:var(--shadow);margin-bottom:24px;}
  .grading-section h3{font-family:'DM Serif Display',serif;font-size:20px;margin-bottom:6px;}
  .grading-section .sub{font-size:14px;color:var(--gray-mid);margin-bottom:24px;}
  .manual-q{border:1px solid var(--gray-light);border-radius:10px;padding:20px;margin-bottom:16px;}
  .manual-q-label{font-size:13px;font-weight:700;color:var(--sky-dark);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:8px;}
  .manual-q-text{font-size:15px;font-weight:500;color:var(--black);margin-bottom:12px;line-height:1.5;}
  .manual-q-response{background:#F8FAFC;border-radius:8px;padding:14px;font-size:14px;color:var(--gray-dark);
    line-height:1.7;margin-bottom:14px;min-height:50px;font-style:italic;}
  .grade-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .grade-label{font-size:13px;font-weight:600;color:var(--gray-mid);margin-right:4px;}
  .grade-btn{padding:7px 18px;border-radius:8px;border:2px solid transparent;
    font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .18s;}
  .grade-btn.pass{border-color:var(--green);color:#15803D;background:transparent;}
  .grade-btn.pass:hover,.grade-btn.pass.active{background:var(--green);color:white;}
  .grade-btn.fail{border-color:var(--red);color:#B91C1C;background:transparent;}
  .grade-btn.fail:hover,.grade-btn.fail.active{background:var(--red);color:white;}
  .grade-btn.partial{border-color:var(--gold);color:#92400E;background:transparent;}
  .grade-btn.partial:hover,.grade-btn.partial.active{background:var(--gold);color:white;}
  .grade-note-input{width:100%;margin-top:10px;border:1px solid var(--gray-light);border-radius:8px;
    padding:10px 14px;font-size:13px;font-family:'DM Sans',sans-serif;color:var(--gray-dark);outline:none;transition:border-color .2s;}
  .grade-note-input:focus{border-color:var(--sky);}
  .final-score-btn{width:100%;padding:16px;background:var(--black);color:white;border:none;
    border-radius:10px;font-family:'DM Sans',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:background .2s;margin-top:8px;}
  .final-score-btn:hover{background:var(--gray-dark);}
  .final-score-display{background:linear-gradient(135deg,var(--sky-dark),var(--sky));color:white;border-radius:12px;
    padding:24px 32px;text-align:center;margin-top:16px;display:none;}
  .final-score-display.show{display:block;animation:fadeSlide .4s ease both;}
  .final-score-display .big{font-family:'DM Serif Display',serif;font-size:44px;}
  .final-score-display .detail{font-size:15px;opacity:0.85;margin-top:8px;}

  /* SAVE / SYNC BUTTON */
  .save-results-btn{width:100%;padding:16px;border:none;border-radius:10px;
    font-family:'DM Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;
    transition:all .2s;margin-top:12px;display:flex;align-items:center;justify-content:center;gap:8px;}
  .save-results-btn.idle{background:var(--sky-dark);color:white;}
  .save-results-btn.idle:hover{background:#1e7dab;}
  .save-results-btn.saving{background:var(--gray-mid);color:white;cursor:default;}
  .save-results-btn.saved{background:var(--green);color:white;cursor:default;}
  .save-results-btn.error{background:var(--red);color:white;}
  .print-btn{display:flex;align-items:center;justify-content:center;gap:8px;padding:11px 22px;
    border:2px solid var(--gray-light);border-radius:10px;background:transparent;
    font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;color:var(--gray-mid);
    cursor:pointer;transition:all .2s;margin-top:12px;width:100%;}
  .print-btn:hover{border-color:var(--sky);color:var(--sky-dark);}

  /* INFO BOX */
  .info-box{background:var(--sky-light);border-radius:var(--radius);padding:18px 24px;font-size:14px;
    color:var(--sky-dark);border:1px solid rgba(74,189,232,0.25);margin-bottom:24px;}

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN LOGIN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .admin-login-wrap{max-width:420px;margin:80px auto;padding:20px;}
  .admin-login-card{background:var(--white);border-radius:20px;padding:48px 40px;
    box-shadow:0 8px 40px rgba(15,17,20,0.14);text-align:center;}
  .admin-lock{font-size:48px;margin-bottom:20px;}
  .admin-login-card h2{font-family:'DM Serif Display',serif;font-size:26px;margin-bottom:8px;}
  .admin-login-card p{font-size:14px;color:var(--gray-mid);margin-bottom:32px;}
  .admin-pw-input{width:100%;border:2px solid var(--gray-light);border-radius:10px;padding:14px 18px;
    font-size:16px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s;
    text-align:center;letter-spacing:0.1em;margin-bottom:14px;}
  .admin-pw-input:focus{border-color:var(--sky);}
  .admin-pw-input.error{border-color:var(--red);background:#FFF5F5;animation:shake .3s ease;}
  @keyframes shake{0%,100%{transform:translateX(0);}20%,60%{transform:translateX(-6px);}40%,80%{transform:translateX(6px);}}
  .admin-login-btn{width:100%;padding:14px;background:var(--black);color:white;border:none;
    border-radius:10px;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:background .2s;}
  .admin-login-btn:hover{background:var(--gray-dark);}
  .admin-error{color:var(--red);font-size:13px;margin-top:10px;min-height:18px;}
  .admin-back{margin-top:20px;font-size:13px;color:var(--gray-mid);cursor:pointer;background:none;border:none;font-family:'DM Sans',sans-serif;}
  .admin-back:hover{color:var(--sky-dark);}

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN DASHBOARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .admin-header-bar{background:var(--black);border-radius:20px;padding:36px 40px;color:white;
    margin-bottom:28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;}
  .admin-header-bar h1{font-family:'DM Serif Display',serif;font-size:28px;}
  .admin-header-bar p{color:rgba(255,255,255,0.55);font-size:14px;margin-top:4px;}
  .admin-header-right{display:flex;gap:10px;align-items:center;}
  .admin-logout-btn{padding:9px 20px;border:1px solid rgba(255,255,255,0.2);border-radius:8px;
    background:transparent;color:rgba(255,255,255,0.6);font-family:'DM Sans',sans-serif;
    font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;}
  .admin-logout-btn:hover{border-color:var(--sky);color:var(--sky);}
  .admin-refresh-btn{padding:9px 16px;border:1px solid rgba(74,189,232,0.4);border-radius:8px;
    background:transparent;color:var(--sky);font-family:'DM Sans',sans-serif;
    font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;}
  .admin-refresh-btn:hover{background:rgba(74,189,232,0.1);}
  .admin-refresh-btn.spinning{opacity:0.5;cursor:default;}

  .admin-summary-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:28px;}
  .admin-stat{background:var(--white);border-radius:var(--radius);padding:18px 20px;box-shadow:var(--shadow);}
  .admin-stat .av{font-family:'DM Serif Display',serif;font-size:28px;color:var(--black);line-height:1;}
  .admin-stat .al{font-size:12px;color:var(--gray-mid);font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-top:4px;}
  .admin-stat.sky .av{color:var(--sky-dark);}
  .admin-stat.grn .av{color:var(--green);}
  .admin-stat.gold .av{color:var(--gold);}

  /* sync status badge in dashboard */
  .sync-status{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:600;
    padding:5px 12px;border-radius:20px;margin-bottom:20px;}
  .sync-status.connected{background:#DCFCE7;color:#166534;}
  .sync-status.disconnected{background:#FEE2E2;color:#991B1B;}
  .sync-status.loading{background:var(--sky-light);color:var(--sky-dark);}

  .submissions-card{background:var(--white);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;margin-bottom:24px;}
  .submissions-card-header{padding:20px 28px;border-bottom:1px solid var(--gray-light);
    display:flex;align-items:center;justify-content:space-between;}
  .submissions-card-header h3{font-family:'DM Serif Display',serif;font-size:18px;}

  .no-submissions{padding:48px;text-align:center;color:var(--gray-mid);font-size:15px;}
  .no-submissions .icon{font-size:40px;margin-bottom:12px;}

  .submission-row{padding:20px 28px;border-bottom:1px solid var(--gray-light);cursor:pointer;
    transition:background .15s;display:flex;align-items:center;gap:16px;justify-content:space-between;}
  .submission-row:last-child{border-bottom:none;}
  .submission-row:hover{background:#F8FAFC;}
  .sub-name{font-weight:600;font-size:15px;color:var(--black);}
  .sub-date{font-size:12px;color:var(--gray-mid);margin-top:2px;}
  .sub-scores{display:flex;align-items:center;gap:10px;flex-shrink:0;}
  .score-pill{padding:5px 12px;border-radius:20px;font-size:13px;font-weight:700;white-space:nowrap;}
  .score-pill.high{background:#DCFCE7;color:#15803D;}
  .score-pill.mid{background:#FEF9C3;color:#854D0E;}
  .score-pill.low{background:#FEE2E2;color:#991B1B;}
  .score-pill.pending{background:var(--sky-light);color:var(--sky-dark);}
  .expand-icon{color:var(--gray-mid);font-size:18px;transition:transform .2s;}
  .submission-row.open .expand-icon{transform:rotate(180deg);}

  /* DETAIL PANEL */
  .submission-detail{display:none;padding:0 28px 28px;border-bottom:1px solid var(--gray-light);background:#FAFCFE;}
  .submission-detail.open{display:block;animation:fadeSlide .25s ease both;}
  .detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;margin-top:4px;}
  .detail-stat{background:var(--white);border-radius:10px;padding:14px 16px;border:1px solid var(--gray-light);}
  .detail-stat .dv{font-family:'DM Serif Display',serif;font-size:22px;color:var(--black);}
  .detail-stat .dl{font-size:12px;color:var(--gray-mid);margin-top:2px;}
  .detail-section-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--gray-mid);margin:20px 0 10px;}
  .answer-list{display:flex;flex-direction:column;gap:8px;}
  .answer-item{display:flex;align-items:flex-start;gap:10px;padding:10px 14px;border-radius:8px;font-size:13px;line-height:1.5;}
  .answer-item.corr{background:#F0FDF4;border:1px solid #BBF7D0;}
  .answer-item.incr{background:#FFF5F5;border:1px solid #FECACA;}
  .answer-item.skip{background:var(--gray-light);border:1px solid var(--gray-light);}
  .answer-icon{font-size:14px;flex-shrink:0;margin-top:1px;}
  .answer-qtext{font-weight:500;color:var(--black);}
  .answer-given{color:var(--gray-mid);font-size:12px;margin-top:2px;}

  .admin-written-q{background:var(--white);border:1px solid var(--gray-light);border-radius:10px;padding:18px;margin-bottom:12px;}
  .admin-wq-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.07em;color:var(--sky-dark);margin-bottom:8px;}
  .admin-wq-text{font-size:14px;font-weight:500;color:var(--black);margin-bottom:10px;line-height:1.5;}
  .admin-wq-resp{background:#F8FAFC;border-radius:8px;padding:12px;font-size:13px;color:var(--gray-dark);
    line-height:1.7;margin-bottom:12px;font-style:italic;min-height:36px;}
  .admin-grade-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
  .admin-grade-note{width:100%;margin-top:8px;border:1px solid var(--gray-light);border-radius:8px;
    padding:9px 12px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s;}
  .admin-grade-note:focus{border-color:var(--sky);}
  .admin-save-grades-btn{margin-top:14px;padding:10px 24px;background:var(--sky-dark);color:white;border:none;
    border-radius:8px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:background .2s;}
  .admin-save-grades-btn:hover{background:#1e7dab;}
  .admin-save-grades-btn.saved{background:var(--green);}
  .detail-guidance{background:var(--sky-light);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--sky-dark);line-height:1.6;margin-bottom:10px;}

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SETUP GUIDE SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .setup-card{background:var(--white);border-radius:20px;padding:48px;box-shadow:var(--shadow);margin-bottom:24px;}
  .setup-card h2{font-family:'DM Serif Display',serif;font-size:28px;margin-bottom:8px;}
  .setup-card .lead{font-size:16px;color:var(--gray-mid);margin-bottom:36px;line-height:1.6;}
  .setup-steps{display:flex;flex-direction:column;gap:0;}
  .setup-step{display:flex;gap:20px;padding:24px 0;border-bottom:1px solid var(--gray-light);}
  .setup-step:last-child{border-bottom:none;}
  .step-num{width:36px;height:36px;border-radius:50%;background:var(--black);color:white;
    display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;flex-shrink:0;margin-top:2px;}
  .step-content h4{font-size:16px;font-weight:700;margin-bottom:6px;}
  .step-content p{font-size:14px;color:var(--gray-mid);line-height:1.6;margin-bottom:10px;}
  .step-content code{display:block;background:#1e1e2e;color:#4ABDE8;border-radius:8px;padding:12px 16px;
    font-size:13px;font-family:monospace;line-height:1.7;white-space:pre-wrap;word-break:break-all;margin-top:8px;}
  .step-content .copy-btn{margin-top:8px;padding:7px 16px;background:var(--sky-light);color:var(--sky-dark);
    border:none;border-radius:7px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:background .2s;}
  .step-content .copy-btn:hover{background:var(--sky-dark);color:white;}
  .url-input-row{display:flex;gap:10px;margin-top:10px;}
  .url-field{flex:1;border:2px solid var(--gray-light);border-radius:8px;padding:12px 14px;
    font-size:14px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s;}
  .url-field:focus{border-color:var(--sky);}
  .url-save-btn{padding:12px 20px;background:var(--black);color:white;border:none;border-radius:8px;
    font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;white-space:nowrap;transition:background .2s;}
  .url-save-btn:hover{background:var(--gray-dark);}
  .setup-done-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--sky-dark),var(--sky));
    color:white;border:none;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:16px;
    font-weight:700;cursor:pointer;margin-top:8px;transition:opacity .2s;}
  .setup-done-btn:hover{opacity:0.9;}

  @media(max-width:640px){
    .intro-hero{padding:36px 24px;}
    .intro-hero h1{font-size:26px;}
    .stats-row,.admin-summary-row{grid-template-columns:1fr 1fr;}
    .tf-grid{flex-direction:column;}
    .q-card,.name-card{padding:20px;}
    .detail-grid{grid-template-columns:1fr;}
    .admin-header-bar{padding:24px;}
    .setup-card{padding:28px 24px;}
    .site-header{padding:0 20px;}
  }
  @media print{
    .site-header,.submit-btn,.print-btn,.save-results-btn,.check-btn,.setup-banner{display:none!important;}
    .wrapper{padding:0;}
  }
</style>
</head>
<body>

<header class="site-header">
  <div class="logo">Savvy <span>Realty</span></div>
  <div class="header-right">
    <div class="header-badge" id="header-badge">VA Training Assessment</div>
    <button class="admin-link" id="admin-nav-btn" onclick="goAdminLogin()">Admin â†—</button>
  </div>
</header>

<!-- Setup banner shown when no script URL is saved -->
<div class="setup-banner" id="setup-banner" style="display:none;">
  <span class="icon">âš™ï¸</span>
  <span><strong>One-time setup needed:</strong> Connect this file to Google Sheets so scores sync across browsers.
  <a onclick="showScreen('screen-setup')">Open Setup Guide â†’</a></span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     INTRO SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-intro" class="screen active">
  <div class="wrapper">
    <div class="intro-hero">
      <h1>Listings VA<br><em>Certification Assessment</em></h1>
      <p>This 40-question assessment covers everything from your core training modules: lead flow, CRM management, Rabbu imports, skip tracing, reporting, SmartPlans, and more.</p>
      <div class="intro-meta">
        <div class="meta-chip"><span>ğŸ“‹</span> 40 Questions</div>
        <div class="meta-chip"><span>âš¡</span> Mixed Formats</div>
        <div class="meta-chip"><span>âœï¸</span> 5 Written Responses</div>
        <div class="meta-chip"><span>ğŸ¯</span> Focus: Lead Flow & Imports</div>
      </div>
    </div>
    <div class="name-card">
      <label for="trainee-name">Your Full Name</label>
      <input type="text" class="field-input" id="trainee-name" placeholder="Enter your name before startingâ€¦" autocomplete="name">
    </div>
    <div class="info-box">
      <strong>ğŸ“Œ Instructions:</strong> Questions are grouped by topic. Multiple choice, true/false, and fill-in-the-blank answers are graded instantly. Written responses are reviewed by your manager in the Admin Dashboard. Click Check Answer on each question to see feedback as you go.
    </div>
    <button class="btn-primary" onclick="startAssessment()" style="width:100%;padding:18px;font-size:17px;">Begin Assessment â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ASSESSMENT SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-assessment" class="screen">
  <div class="wrapper">
    <div class="progress-label">
      <span id="progress-text">0% Complete</span>
      <span id="score-live">Auto-score: 0 / 0 graded</span>
    </div>
    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progress-fill" style="width:0%"></div></div>
    <div id="questions-container"></div>
    <button class="submit-btn" onclick="submitAssessment()">Submit Assessment & View Results â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESULTS SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-results" class="screen">
  <div class="wrapper">
    <div class="result-hero">
      <div class="score-ring" id="score-ring">
        <div class="score-inner">
          <div class="score-pct" id="score-pct">0%</div>
          <div class="score-sub">Auto-Graded</div>
        </div>
      </div>
      <h2 id="result-heading">Assessment Complete!</h2>
      <p>Results for <strong id="result-name"></strong> &nbsp;Â·&nbsp; <span id="result-date"></span></p>
    </div>
    <div class="stats-row">
      <div class="stat-card green"><div class="val" id="stat-correct">0</div><div class="lbl">Correct</div></div>
      <div class="stat-card red">  <div class="val" id="stat-wrong">0</div><div class="lbl">Incorrect</div></div>
      <div class="stat-card gold"> <div class="val">5</div><div class="lbl">Pending Review</div></div>
    </div>
    <div class="grading-section">
      <h3>âœï¸ Written Response Grading</h3>
      <p class="sub">These will be reviewed by your manager in the Admin Dashboard. You can optionally self-grade here first.</p>
      <div id="manual-grading-area"></div>
      <button class="final-score-btn" onclick="calcFinalScore()">Calculate Estimated Score</button>
      <div class="final-score-display" id="final-score-display">
        <div class="big" id="final-pct">â€”</div>
        <div class="detail" id="final-detail">â€”</div>
      </div>
    </div>
    <button class="save-results-btn idle" id="save-btn" onclick="saveResults()">
      â˜ï¸ Submit Results to Admin Dashboard
    </button>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ Print / Save as PDF</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-admin-login" class="screen">
  <div class="admin-login-wrap">
    <div class="admin-login-card">
      <div class="admin-lock">ğŸ”</div>
      <h2>Admin Access</h2>
      <p>Enter the admin password to view all VA submissions and grade written responses.</p>
      <input type="password" class="admin-pw-input" id="admin-pw" placeholder="Password"
        onkeydown="if(event.key==='Enter')tryAdminLogin()">
      <button class="admin-login-btn" onclick="tryAdminLogin()">Sign In â†’</button>
      <div class="admin-error" id="admin-error"></div>
      <br>
      <button class="admin-back" onclick="showScreen('screen-intro')">â† Back to Assessment</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN DASHBOARD SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-admin" class="screen">
  <div class="wrapper">
    <div class="admin-header-bar">
      <div>
        <h1>Admin Dashboard</h1>
        <p>Savvy Realty â€” VA Training Assessment Results</p>
      </div>
      <div class="admin-header-right">
        <button class="admin-refresh-btn" id="refresh-btn" onclick="loadAdminData()">â†» Refresh</button>
        <button class="admin-refresh-btn" onclick="showSetupFromAdmin()" style="border-color:rgba(255,255,255,0.2);color:rgba(255,255,255,0.5);">âš™ï¸ Setup</button>
        <button class="admin-logout-btn" onclick="adminLogout()">Sign Out</button>
      </div>
    </div>

    <div id="admin-sync-status"></div>
    <div class="admin-summary-row" id="admin-summary-row">
      <div class="admin-stat sky"><div class="av">â€”</div><div class="al">Total Submissions</div></div>
      <div class="admin-stat grn"><div class="av">â€”</div><div class="al">Fully Graded</div></div>
      <div class="admin-stat gold"><div class="av">â€”</div><div class="al">Pending Review</div></div>
      <div class="admin-stat"><div class="av">â€”</div><div class="al">Avg Auto-Score</div></div>
    </div>

    <div class="submissions-card">
      <div class="submissions-card-header">
        <h3>Submissions</h3>
      </div>
      <div id="submissions-list">
        <div class="no-submissions"><div class="icon">â³</div>Loading submissionsâ€¦</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SETUP GUIDE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-setup" class="screen">
  <div class="wrapper">
    <div class="setup-card">
      <h2>âš™ï¸ Google Sheets Setup Guide</h2>
      <p class="lead">Follow these 5 steps to connect this assessment to a Google Sheet. Once done, every submission syncs automatically and your whole team can view results from the Admin Dashboard â€” on any browser, any device.</p>

      <div class="setup-steps">

        <div class="setup-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <h4>Create a new Google Sheet</h4>
            <p>Go to <strong>sheets.google.com</strong>, create a blank spreadsheet, and name it something like <em>"Savvy VA Assessment Results"</em>. Leave it open â€” you'll need it in the next step.</p>
          </div>
        </div>

        <div class="setup-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <h4>Open the Script Editor</h4>
            <p>In your new Google Sheet, click the menu: <strong>Extensions â†’ Apps Script</strong>. A new tab will open with a code editor. Delete anything in the editor, then paste the entire contents of the <strong>savvy-assessment-script.gs</strong> file provided with this package.</p>
          </div>
        </div>

        <div class="setup-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <h4>Deploy as a Web App</h4>
            <p>In the Apps Script editor, click <strong>Deploy â†’ New Deployment</strong>. Configure it like this:</p>
            <code>Type:               Web App
Description:        Savvy VA Assessment
Execute as:         Me
Who has access:     Anyone</code>
            <p style="margin-top:10px;">Click <strong>Deploy</strong>, authorize when prompted, then <strong>copy the Web App URL</strong> â€” you'll need it in Step 5.</p>
          </div>
        </div>

        <div class="setup-step">
          <div class="step-num">4</div>
          <div class="step-content">
            <h4>Share this HTML file with your team</h4>
            <p>Save this HTML file somewhere your whole team can access it â€” a shared Google Drive folder works perfectly. Everyone opens the same file in their browser. No server or hosting needed.</p>
          </div>
        </div>

        <div class="setup-step">
          <div class="step-num">5</div>
          <div class="step-content">
            <h4>Paste your Web App URL below</h4>
            <p>Paste the URL you copied in Step 3. Once saved, all submissions will sync to your Google Sheet automatically.</p>
            <div class="url-input-row">
              <input type="text" class="url-field" id="script-url-input"
                placeholder="https://script.google.com/macros/s/â€¦/exec">
              <button class="url-save-btn" onclick="saveScriptUrl()">Save URL</button>
            </div>
            <p id="url-save-status" style="font-size:13px;margin-top:8px;color:var(--green);display:none;">âœ… URL saved! The assessment is now connected to Google Sheets.</p>
          </div>
        </div>

      </div>
    </div>
    <button class="setup-done-btn" onclick="finishSetup()">I'm Done â€” Go to Admin Dashboard â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DATA & JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG  â€” set by setup guide
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_PASSWORD = 'SavvyAdmin2026';
const SCRIPT_URL_KEY = 'savvy_script_url';

function getScriptUrl() { return localStorage.getItem(SCRIPT_URL_KEY) || ''; }

// Show setup banner on load if no URL configured
window.addEventListener('load', () => {
  if (!getScriptUrl()) document.getElementById('setup-banner').style.display = 'flex';
});

function saveScriptUrl() {
  const url = document.getElementById('script-url-input').value.trim();
  if (!url.startsWith('https://script.google.com')) {
    alert('Please enter a valid Google Apps Script URL (starts with https://script.google.com)');
    return;
  }
  localStorage.setItem(SCRIPT_URL_KEY, url);
  document.getElementById('url-save-status').style.display = 'block';
  document.getElementById('setup-banner').style.display = 'none';
}

function finishSetup() {
  if (!getScriptUrl()) { alert('Please complete Step 5 and save your Script URL first.'); return; }
  showScreen('screen-admin-login');
}

function showSetupFromAdmin() {
  const url = getScriptUrl();
  if (url) document.getElementById('script-url-input').value = url;
  showScreen('screen-setup');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUESTION BANK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const questions = [

  // â”€â”€â”€ SECTION 1: Systems & Tools â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 1 â€” Systems & Tools", sectionAccent:false,
    id:1, type:"mc",
    q:"A lead is in Softy, has a scheduled call in Google Calendar, and needs a listing appointment logged â€” which combination of tools handles each task <span class='highlight'>correctly</span>?",
    options:[
      "Softy for the call log, Google Calendar for the appointment, Airtable for communication",
      "Softy for communication, Google Calendar for scheduling, Airtable for logging the appointment",
      "Airtable for communication, Softy for scheduling, Google Calendar for the appointment log",
      "Google Calendar for everything â€” it syncs to Softy and Airtable automatically"
    ], answer:1,
    feedback:"Softy handles all communication, Google Calendar manages scheduling, and Airtable is where you log the listing appointment. Each tool has a distinct role." },

  { id:2, type:"mc",
    q:"You're mid-conversation with a lead in Softy and realize their timezone was never confirmed before the call was scheduled. The calendar invite already went out. What is the correct next step?",
    options:[
      "Leave it â€” the lead will figure out the timezone on their own",
      "Delete the calendar event and start over",
      "Text the lead immediately to confirm their timezone and update the calendar invite if needed",
      "Ask the Listings ISA to handle it since it's their call"
    ], answer:2,
    feedback:"You must text the lead right away to confirm timezone and correct the calendar invite if it's wrong. Timezone errors are one of the most common scheduling mistakes â€” catching it early protects the appointment." },

  { id:3, type:"tf",
    q:"If a lead exists in Softy but has never been logged in Airtable, that lead is considered properly tracked in Savvy's system.",
    answer:false,
    feedback:"False â€” Softy handles communication but Airtable is the tracking and reporting system. A lead not logged in Airtable is invisible to leadership and reporting. Both systems must reflect activity accurately." },

  { id:4, type:"mc",
    q:"Which of the following describes the <span class='highlight'>correct</span> use of Gmail within the Listings VA workflow?",
    options:[
      "Primary channel for texting leads who don't respond in Softy",
      "Agent outreach, status update emails, and referral coordination",
      "Sending listing agreements and contracts to clients",
      "Logging appointment confirmations after calls are completed"
    ], answer:1,
    feedback:"Gmail is specifically for agent outreach, status update emails, and referral coordination â€” not for lead texting (that's Softy) or logging (that's Airtable)." },

  { id:5, type:"tf",
    q:"Savvy acts as a direct listing brokerage â€” meaning agents work exclusively for Savvy and are not referral partners from outside networks.",
    answer:false,
    feedback:"False â€” Savvy connects clients with agents including referral partners from outside networks. Not all agents are Savvy expansion agents, which is why the Referral Listing Appts sheet exists." },

  // â”€â”€â”€ SECTION 2: Lead Flow & Communication â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 2 â€” Lead Flow & Communication", sectionAccent:true,
    id:6, type:"mc",
    q:"A lead responds to your text saying: <em>\"I'm ready to list â€” can you just send me the paperwork?\"</em> What is the correct response according to Savvy's communication philosophy?",
    options:[
      "Congratulate them and send the listing agreement immediately",
      "Explain the full listing process over text so they know what to expect",
      "Redirect them to schedule a Listings ISA call first â€” paperwork comes after that step",
      "Connect them directly with an agent via text and copy the ISA"
    ], answer:2,
    feedback:"Even enthusiastic leads must go through the ISA call first. We do not skip steps or send paperwork via text. The ISA call qualifies the lead and determines next steps." },

  { id:7, type:"mc",
    q:"You have three leads in Softy: one hasn't responded in 2 weeks, one said 'maybe later,' and one explicitly said 'remove me from your list.' Which action is correct for each?",
    options:[
      "Unsubscribe all three â€” none are engaged",
      "Continue following up on all three until they respond",
      "Set a follow-up for the first two; unsubscribe only the third",
      "Unsubscribe the first two; set a follow-up for the third"
    ], answer:2,
    feedback:"Only unsubscribe when a lead explicitly requests no further contact. Low engagement and 'maybe later' are not reasons to unsubscribe â€” set follow-ups and stay in the pipeline." },

  { id:8, type:"tf",
    q:"When a lead asks a detailed question about STR zoning regulations, the correct response is to answer it fully over text to demonstrate Savvy's expertise.",
    answer:false,
    feedback:"False â€” we do NOT try to fully educate leads over text. Answer briefly if needed, then redirect toward scheduling a call. Over-explaining can delay or derail the path to an ISA call." },

  { id:9, type:"mc",
    q:"You've been going back and forth with a lead for several days. They keep asking questions but won't commit to a call. What is the most effective approach?",
    options:[
      "Keep answering their questions in detail â€” build trust first",
      "Stop responding until they ask to schedule",
      "Acknowledge their questions briefly, then anchor every reply back to a specific call time: 'Would Tuesday at 2pm or Wednesday at 10am work for a quick 15-minute call?'",
      "Escalate to the Listings Manager immediately"
    ], answer:2,
    feedback:"Offering two specific time options is a proven technique to move hesitant leads toward commitment. It removes open-ended friction and gives them a simple yes/no decision." },

  { id:10, type:"tf",
    q:"If the Listings Manager has not approved a text template, a VA may still use it as long as the message sounds professional.",
    answer:false,
    feedback:"False â€” only approved templates should be used. Using unapproved messaging risks inconsistency, brand issues, and miscommunication. When in doubt, ask before sending." },

  // â”€â”€â”€ SECTION 3: Scheduling & Appointments â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 3 â€” Scheduling & Appointments", sectionAccent:false,
    id:11, type:"mc",
    q:"You schedule a listing ISA call for a client in Phoenix, AZ, but the ISA is in New York. You log the time as 2:00 PM without specifying a timezone. What is the likely outcome and how should this have been handled?",
    options:[
      "No issue â€” both parties will figure it out before the call",
      "The call may happen 3 hours off; always confirm timezone with the lead and specify it explicitly in Airtable and the confirmation text",
      "This is the ISA's responsibility, not the VA's",
      "Just log EST since Savvy operates from the East Coast"
    ], answer:1,
    feedback:"A 3-hour timezone gap is a real risk here. The VA must confirm timezone with the lead, log it clearly in Airtable, and include it in the confirmation text â€” every time, no exceptions." },

  { id:12, type:"mc",
    q:"An agent you've never worked with before reaches out saying a client is ready for a listing appointment. What must you verify <span class='highlight'>before</span> scheduling anything?",
    options:[
      "That the agent has a valid real estate license",
      "That the agent is approved â€” check Airtable Buyers Agent tab to confirm expansion vs. referral status, then confirm with Listings Manager if needed",
      "That the client is already in Softy",
      "That the appointment time doesn't conflict with another ISA call"
    ], answer:1,
    feedback:"Always verify agent status in Airtable before scheduling. Unknown agents must be classified as expansion or referral before the appointment is logged, otherwise it will be entered in the wrong sheet." },

  { id:13, type:"tf",
    q:"It is acceptable to send a client an agent's contact information via text before the listing appointment is officially confirmed, as long as the agent already agreed to take the client.",
    answer:false,
    feedback:"False â€” do NOT send agent information until the appointment is confirmed. Sending early can create confusion, misaligned expectations, and premature direct contact that bypasses the process." },

  { id:14, type:"mc",
    q:"You booked a listing ISA call but forgot to log it in Airtable before the end of the day. The call happened and went well. What should you do?",
    options:[
      "Skip the Airtable entry â€” the call is done so it doesn't matter now",
      "Log it retroactively in Airtable immediately with the correct date and time â€” late logging is better than no logging",
      "Ask the ISA to log it since they were on the call",
      "Only log it if a listing appointment results from the call"
    ], answer:1,
    feedback:"Log it immediately even if late. Every call must be in Airtable â€” it's the only way leadership can track activity and performance. Gaps in Airtable = gaps in reporting." },

  { id:15, type:"mc",
    q:"A client replies to your confirmation text saying they can no longer make the scheduled ISA call and asks to reschedule. Walk through the correct sequence of steps.",
    options:[
      "Tell the client to reach back out when they're ready",
      "Forward the message to the ISA and let them handle rescheduling",
      "Confirm cancellation with the client, remove the calendar event, notify the ISA, reschedule in Softy, send a new confirmation text with date/time/timezone/ISA name, update Airtable",
      "Reschedule directly in Google Calendar and send a new invite without texting the client"
    ], answer:2,
    feedback:"A reschedule touches every system: cancel and update the calendar, notify the ISA, reschedule in Softy, send a full new confirmation text, and update Airtable. Skipping any step creates gaps." },

  // â”€â”€â”€ SECTION 4: Rabbu Lead Import â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 4 â€” Rabbu Lead Import to Lofty", sectionAccent:true,
    id:16, type:"mc",
    q:"When you download the Rabbu Metabase CSV, you notice some leads have a phone number but no email, and others have an email but no phone number. Which leads should be removed?",
    options:[
      "Remove leads missing either a phone number or an email",
      "Remove only leads missing both a phone number and an email",
      "Remove leads missing a phone number â€” email alone is not enough to work",
      "Keep all leads regardless â€” Lofty can find missing contact info automatically"
    ], answer:1,
    feedback:"Only remove leads that are missing BOTH phone AND email. A lead with just a phone number or just an email still has usable contact information and should be imported." },

  { id:17, type:"tf",
    q:"If daily Rabbu lead volume is very low â€” say 3 or 4 leads â€” it is acceptable to add them manually one-by-one directly into Lofty rather than going through the full CSV import process.",
    answer:true,
    feedback:"True â€” the SOP confirms that when volume is low and manageable, manually adding leads one-by-one is an acceptable alternative to the full spreadsheet workflow. Use judgment based on volume." },

  { id:18, type:"mc",
    q:"You're mapping fields during a Rabbu import into Lofty. The CSV has a column called 'Property Address' and another called 'Owner Mailing Address.' Which do you map to Lofty's address field?",
    options:[
      "Owner Mailing Address â€” that's where communication should be directed",
      "Both â€” import both addresses to have complete records",
      "Property Address, mapped to 'Property Full Address (Selling)'",
      "Neither â€” address fields should not be imported for Rabbu leads"
    ], answer:2,
    feedback:"Always use the Property Address mapped to 'Property Full Address (Selling)' in Lofty â€” not the mailing address. The property being sold is what matters for the listing conversation." },

  { id:19, type:"mc",
    q:"After a Rabbu import, you applied the 'Rabbu' tag but forgot to apply the 'Rabbu Smart Plan' tag before closing Lofty. You realize this an hour later. What is the correct action?",
    options:[
      "Leave it â€” the Rabbu tag is enough to trigger outreach",
      "Go back into Lofty, find the imported leads, and apply the Rabbu Smart Plan tag immediately",
      "Wait until tomorrow's import and apply both tags then",
      "Notify the Listings Manager and let them handle it"
    ], answer:1,
    feedback:"Go back and apply the missing tag immediately. Without the Rabbu Smart Plan tag, those leads won't receive the correct automated outreach sequence â€” every hour of delay means delayed engagement." },

  { id:20, type:"tf",
    q:"A lead in the Rabbu CSV is listed as Seller Type: 'Owner' but has no property URL and no asking price listed. This lead should still be imported if they have usable contact information.",
    answer:true,
    feedback:"True â€” the import decision is based on contact information availability (phone and/or email), not on whether supplemental fields like property URL or asking price are present. Import them and note what's missing." },

  { id:21, type:"mc",
    q:"You're doing a Rabbu import and notice 12 leads in the CSV were already imported two weeks ago â€” their names and phone numbers match existing Lofty records. What should you do?",
    options:[
      "Import them again â€” duplicates are fine, Lofty will merge them",
      "Skip the entire import batch to avoid any risk of duplicates",
      "Remove the duplicate leads from the CSV before importing, then proceed with the remaining new leads",
      "Import all leads and manually delete duplicates afterward"
    ], answer:2,
    feedback:"Remove known duplicates before importing. Creating duplicate records in Lofty pollutes the CRM, can trigger double outreach, and makes reporting inaccurate. Clean the list first." },

  { id:22, type:"mc",
    q:"The Rabbu daily email arrives at 9:00 a.m. showing 20 leads. You're behind on other tasks and don't get to the import until 4:00 p.m. What is the impact of this delay?",
    options:[
      "No impact â€” lead response rates are the same regardless of when outreach starts",
      "Minimal impact â€” Rabbu leads are pre-warmed so timing doesn't matter",
      "Delayed outreach â€” leads contacted hours later have lower engagement rates and the Smart Plan starts late, potentially missing the optimal response window",
      "The leads expire and must be re-requested from Rabbu"
    ], answer:2,
    feedback:"Speed matters. Delayed imports mean delayed Smart Plan outreach. Lead engagement is highest shortly after they first register â€” the longer the gap, the lower the response rate." },

  { id:23, type:"tf",
    q:"The Ownership Level field during a Lofty import should always be set to assign the owner based on the assignee listed in the Rabbu data.",
    answer:true,
    feedback:"True â€” Ownership Level must be assigned based on the assignee, not defaulted or left blank. This ensures leads are routed to the correct team member from the moment they enter Lofty." },

  { id:24, type:"mc",
    q:"You finish a Rabbu import and realize you accidentally imported the Registration Date for all 47 leads. What is the problem this creates, and what should you do?",
    options:[
      "No problem â€” the Registration Date is useful context inside Lofty",
      "The Registration Date will overwrite the lead's create date in Lofty, making it appear they entered Savvy's system weeks or months ago â€” contact the Listings Manager to correct affected records",
      "The Registration Date will cause the Smart Plan to fire on the wrong schedule",
      "It creates a duplicate record for each lead"
    ], answer:1,
    feedback:"Importing the Registration Date corrupts the CRM timeline â€” Lofty will show an incorrect entry date which throws off reporting, follow-up timing, and lead age calculations. Flag it immediately so it can be corrected." },

  { id:25, type:"mc",
    q:"Which of the following is the most accurate description of why Savvy cannot fully automate the Rabbu import process?",
    options:[
      "Lofty's CSV importer has a bug that prevents automation",
      "The Rabbu email only contains a screenshot, not a downloadable file â€” and Savvy lacks direct database access to Rabbu, requiring manual daily download and cleaning",
      "Rabbu only provides lead data once per week, making automation impractical",
      "Automation is possible but has not been prioritized by the tech team yet"
    ], answer:1,
    feedback:"The core issue is twofold: the daily email contains a screenshot (not usable data), and Savvy doesn't have direct API or database access to Rabbu. Both factors make full automation impossible with the current setup." },

  // â”€â”€â”€ SECTION 5: Lead Tracking & Reporting â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 5 â€” Lead Tracking & Reporting", sectionAccent:false,
    id:26, type:"mc",
    q:"An agent named Chris Holloway is assigned to a listing appointment. You search for him in the Airtable Buyers Agent tab and find no results. What is the correct next step?",
    options:[
      "Log the appointment in Chris Holloway's own sheet since he provided his name",
      "Log the appointment in the Referral Listing Appts sheet and do not create a new agent sheet",
      "Create a new individual agent sheet for Chris Holloway and log it there",
      "Skip logging until the agent's status is confirmed by Rabbu"
    ], answer:1,
    feedback:"If an agent is not listed in Airtable as a Savvy expansion agent, they are a referral agent â€” log the appointment in Referral Listing Appts. Never create new agent sheets on your own." },

  { id:27, type:"tf",
    q:"If a Rabbu lead's listing appointment is canceled before it takes place, you should delete their entry from both the Listings Reporting sheet and the Rabbu Sellers Database.",
    answer:false,
    feedback:"False â€” never delete entries. Update the status to reflect the cancellation. Deleting records removes historical data that leadership and partners rely on for performance tracking and reporting accuracy." },

  { id:28, type:"mc",
    q:"You notice the Dashboard tab in the Listings Reporting sheet is showing a total that seems too low. Which of the following is the correct course of action?",
    options:[
      "Adjust the formula in the dashboard to account for the entries you know are missing",
      "Add a manual override row at the bottom of the dashboard to correct the total",
      "Do not touch the dashboard â€” flag the discrepancy to the Listings Manager with specific details about what looks off",
      "Re-enter all listing appointments to force the dashboard to recalculate"
    ], answer:2,
    feedback:"Never touch the dashboard. It's formula-driven and any edit can break the entire reporting sheet. Document exactly what looks wrong and notify the Listings Manager immediately." },

  { id:29, type:"mc",
    q:"A Rabbu lead goes through three status changes in one week: they respond to messaging, schedule a call, and then go cold before the call happens. How many times should the Rabbu Sellers Database be updated?",
    options:[
      "Once â€” at the end of the week with the final status",
      "Twice â€” when they respond and when they go cold",
      "Three times â€” every status change requires an update",
      "Only once the outcome is known â€” no point updating a live situation"
    ], answer:2,
    feedback:"Every status change must be logged as it happens â€” respond, schedule, go cold are all three separate updates. Real-time accuracy is what makes the Rabbu Sellers Database useful for partnership reporting." },

  { id:30, type:"mc",
    q:"You logged a listing appointment in the 'All Listing Appointments Set' tab but forgot to add it to the agent's individual sheet. The dashboard is now showing inflated totals for that agent. What do you do?",
    options:[
      "Add the entry to the agent's individual sheet immediately and notify the Listings Manager of the gap",
      "Leave it â€” the 'All Listing Appointments Set' tab is the only one that matters",
      "Delete the entry from 'All Listing Appointments Set' and re-enter everything correctly from scratch",
      "Edit the dashboard to manually subtract the duplicate"
    ], answer:0,
    feedback:"Add the missing entry to the agent's sheet right away, then notify the Listings Manager. The dashboard should self-correct once the data is in the right place. Never edit the dashboard directly." },

  // â”€â”€â”€ SECTION 6: Weekly Reporting â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 6 â€” Weekly Reporting", sectionAccent:true,
    id:31, type:"mc",
    q:"You're building the weekly report and your Lofty lead count for a source doesn't match what the Listings Reporting Google Sheet shows. What is the correct action?",
    options:[
      "Use the Lofty number â€” it's the primary system",
      "Use the Google Sheet number â€” it's more reliable",
      "Do not send the report â€” flag the discrepancy to the Listings Manager and identify which entries are causing the gap before sending",
      "Average the two numbers and note the discrepancy in the email"
    ], answer:2,
    feedback:"Accuracy over speed â€” always. If numbers don't match across systems, do not guess or average. Identify the gap, flag it to the Listings Manager, and resolve it before the report goes out." },

  { id:32, type:"tf",
    q:"The weekly reporting email distribution list can be reduced at your discretion if you believe some recipients no longer need to receive it.",
    answer:false,
    feedback:"False â€” never remove recipients without explicit approval. The distribution list (full Listings Department, Tyler, and Elana) is set by leadership and must not be modified unilaterally." },

  { id:33, type:"mc",
    q:"To determine how many listing appointments were set from a specific lead source during the past week, which combination of tools and steps gives you the most accurate count?",
    options:[
      "Filter Lofty by lead source tag only â€” that's sufficient",
      "Check Airtable filters for the week's appointments AND cross-reference against the Listings Reporting Google Sheet to validate the count",
      "Ask each ISA how many appointments they set from that source",
      "Pull the number directly from the Dashboard tab in the Listings Reporting sheet"
    ], answer:1,
    feedback:"The most accurate method uses both Airtable (for appointment data) and the Listings Reporting Google Sheet (for cross-validation). Using only one source risks missing entries or double-counting." },

  // â”€â”€â”€ SECTION 7: SmartPlan Management â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 7 â€” SmartPlan Management", sectionAccent:false,
    id:34, type:"mc",
    q:"A new lead source called 'OffMarket Pro' is added to Savvy's pipeline. What two SmartPlan updates must happen immediately?",
    options:[
      "Create a brand new SmartPlan from scratch for OffMarket Pro leads only",
      "Add the OffMarket Pro tag to the Lead Partner SmartPlan trigger conditions AND remove it from the Everybody Else SmartPlan trigger conditions",
      "Add the OffMarket Pro tag to the Everybody Else SmartPlan only",
      "No changes needed â€” existing SmartPlans will automatically detect the new source"
    ], answer:1,
    feedback:"Both steps are mandatory: add the new source to the Lead Partner SmartPlan AND remove it from Everybody Else. Missing either step causes duplicate automation â€” leads receive messaging from both plans simultaneously." },

  { id:35, type:"tf",
    q:"A SmartPlan with Auto-Pause enabled will stop sending messages as soon as the lead opens an email â€” even if they don't reply.",
    answer:false,
    feedback:"False â€” Auto-Pause triggers when the lead responds (replies), not just when they open a message. Opens don't count as engagement in this context. The plan pauses only upon an actual response." },

  { id:36, type:"mc",
    q:"You built a one-off SmartPlan campaign to re-engage cold leads from 6 months ago. The campaign ran successfully. Three weeks later you notice new leads are still being added to it. What went wrong?",
    options:[
      "The SmartPlan's Auto-Pause setting was turned off",
      "The leads were tagged incorrectly during the original campaign",
      "Auto-Apply was never disabled after the campaign ended â€” it continued triggering for any new lead meeting the conditions",
      "The SmartPlan was duplicated accidentally and the copy is still running"
    ], answer:2,
    feedback:"This is exactly what happens when Auto-Apply is left on after a one-off campaign. It keeps firing for every new lead that meets the trigger conditions indefinitely. Always deactivate Auto-Apply immediately after a one-time campaign ends." },

  { id:37, type:"mc",
    q:"You're setting up a new SmartPlan and want to schedule a text message to go out at 8:00 a.m. your local time. The lead is in Hawaii (3 hours behind). Is this within policy, and why?",
    options:[
      "Yes â€” 8:00 a.m. your time is perfectly acceptable for any lead",
      "No â€” all SmartPlan messages must be scheduled within 11:00 AMâ€“7:00 PM, and you must account for the lead's timezone, meaning 8:00 a.m. ET would reach a Hawaii lead at 5:00 a.m. â€” a clear violation",
      "Yes â€” as long as the message is professional, time of day doesn't matter",
      "No â€” texts should only be sent after 12:00 PM regardless of timezone"
    ], answer:1,
    feedback:"The 11:00 AMâ€“7:00 PM window is designed specifically to account for timezone differences across the US. A message going out at 5:00 a.m. local time is a brand and professionalism issue regardless of your local time." },

  // â”€â”€â”€ SECTION 8: Skip Tracing â€” Advanced â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 8 â€” Skip Tracing (AirDNA â†’ Miraz)", sectionAccent:true,
    id:38, type:"mc",
    q:"You're pulling STR data for Stroudsburg and the unfiltered AirDNA list shows 1,240 properties. You apply a filter for 1â€“2 bedroom properties and get 480. You apply a filter for 3â€“5 bedroom properties and get 820 results. What is the correct approach for the 3â€“5 bedroom segment?",
    options:[
      "Export the 820 anyway â€” it's close enough to the 500 limit",
      "Break the 3â€“5 bedroom segment down further using an additional filter (e.g., review rating below 4 stars) until each resulting list is under 500, then export separately",
      "Skip the 3â€“5 bedroom segment â€” it's too large to export cleanly",
      "Switch to a non-admin AirDNA account which has a higher export limit"
    ], answer:1,
    feedback:"820 exceeds the 500-property export limit. You must layer additional filters (like review rating) to bring each segment under 500. There is no higher export limit on any AirDNA account â€” the cap is fixed at 500." },

  { id:39, type:"mc",
    q:"You've compiled all AirDNA exports into a Google Sheet workbook with 8 tabs, one per submarket/filter. You're about to share it with Miraz. What must you do before sharing, and where does the file go?",
    options:[
      "Email the file to Miraz as an attachment",
      "Make a copy of the completed Work Sheet, move the copy into the Miraz Sheets folder with the market name and date in the filename, then share that copy with Miraz and confirm receipt",
      "Share the original Work Sheet directly with Miraz so he can edit it in place",
      "Export the entire workbook as a PDF and send it to Miraz for review"
    ], answer:1,
    feedback:"Never share the original Work Sheet â€” make a copy, move it to the Miraz Sheets folder, name it correctly (market + date), and then share the copy. This preserves the original and keeps folders organized." },

  // â”€â”€â”€ SECTION 9: Referral Agents & Follow-Up â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 9 â€” Referral Agents & Agent Sourcing", sectionAccent:false,
    id:"40a", type:"mc",
    q:"A potential referral agent contacts you through Facebook saying they work in a market Savvy needs. They seem knowledgeable. What is the correct next step?",
    options:[
      "Add them to Lofty as an agent lead and assign them a SmartPlan",
      "Send them the referral agreement immediately to lock them in",
      "Vet them against the qualification criteria (STR knowledge, zoning/regulations, investor experience), then send their details to the Listings Manager for approval before any agreement is shared",
      "Schedule a listing appointment directly with one of Savvy's current clients to test their performance"
    ], answer:2,
    feedback:"Agents must be vetted and approved by the Listings Manager before any agreement is sent. Schumi sends the referral agreement â€” not the VA. Rushing this step risks bringing unqualified agents into the network." },

  { id:"40b", type:"tf",
    q:"For bi-weekly agent follow-ups on listing status, it is acceptable to reach out by email only â€” a follow-up text is optional.",
    answer:false,
    feedback:"False â€” the SOP requires both an email AND a follow-up text when checking on listing status. Using only one channel reduces response rates and creates gaps in status tracking." },

  // â”€â”€â”€ SECTION 10: Written Responses â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { section:"Section 10 â€” Scenario & Process (Written Responses)", sectionAccent:true,
    id:41, type:"written",
    q:"A Rabbu lead named James responds to your outreach saying: <em>\"We already spoke to another agent last week and we're probably going to go with them. Thanks anyway.\"</em><br><br>Write a professional text response that keeps the door open without being pushy, and explain in one sentence below your response why you chose that approach.",
    placeholder:"Write your text to James, then add one sentence explaining your approachâ€¦",
    guidance:"Look for: acknowledges his decision respectfully, does not pressure or oversell, keeps a warm door open (e.g., 'totally understand â€” if anything changes or you want a second opinion, we're here'), professional tone, brief. Explanation should reference Savvy's philosophy of long-term relationships over hard selling." },

  { id:42, type:"written",
    q:"You scheduled a listing ISA call for a client named Patricia at 3:00 PM EST on Thursday. It is now Wednesday evening and you realize you never confirmed her timezone â€” she's based in Denver, CO. Walk through every step you would take right now to fix this before Thursday's call.",
    placeholder:"List every step you would take, in orderâ€¦",
    guidance:"Look for: text Patricia immediately to confirm her timezone, determine if 3:00 PM EST works (that's 1:00 PM MT â€” likely fine, but must confirm), update the calendar invite with the correct timezone noted, notify the ISA of the confirmed timezone, update the Airtable entry, send Patricia a new confirmation text with the corrected time/timezone details clearly stated." },

  { id:43, type:"written",
    q:"Explain the difference between the Listings Reporting Sheet and the Rabbu Sellers Database â€” what each one tracks, who enters data into each, and what happens if a Rabbu listing appointment is only logged in one of them instead of both.",
    placeholder:"Your explanation hereâ€¦",
    guidance:"Look for: Listings Reporting tracks ALL listing appointments regardless of source; Rabbu Sellers Database tracks only Rabbu-sourced lead performance for partnership reporting. VA enters both. If only logged in one: either the master appointment record is missing (if only in Rabbu DB) or Rabbu partnership performance data is incomplete (if only in Listings Reporting) â€” both create blind spots for leadership and the Rabbu partner relationship." },

  { id:44, type:"written",
    q:"A lead named Keisha texted back saying: <em>\"What's the difference between listing with Savvy vs. just listing with a local agent on my own?\"</em><br><br>Write a brief, professional text response that answers her question just enough to keep her interested â€” without over-explaining â€” and moves her toward scheduling a call.",
    placeholder:"Write your text response to Keisha hereâ€¦",
    guidance:"Look for: uses Keisha's name, gives a brief compelling differentiator (e.g., STR-focused, investor expertise, national network, data-driven approach), avoids a long essay-style response, ends with a clear CTA to schedule a quick call, warm and confident tone without being salesy." },

  { id:45, type:"written",
    q:"You're onboarding as a VA and your manager tells you: <em>\"If it's not logged, it didn't happen.\"</em> In 3â€“4 sentences, explain what this means in the context of your daily responsibilities and give two specific examples of what could go wrong at Savvy if this rule isn't followed.",
    placeholder:"Your answer hereâ€¦",
    guidance:"Look for: understands the principle means every action (calls, appointments, status changes) must be documented in the correct system in real time. Examples should be specific: e.g., (1) an unlogged Rabbu listing appointment means Savvy can't prove performance to the Rabbu partner, risking the relationship; (2) a missed Airtable call entry means leadership has no visibility into agent or ISA activity, making performance reviews inaccurate." }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let userAnswers  = {};
let checked      = {};
let autoScore    = 0;
let autoTotal    = 0;
let manualGrades = {};
let gradeNotes   = {};
let submissionId = null;
let resultsSaved = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START ASSESSMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startAssessment() {
  const name = document.getElementById('trainee-name').value.trim();
  if (!name) {
    const inp = document.getElementById('trainee-name');
    inp.style.borderColor='var(--red)'; inp.focus(); return;
  }
  showScreen('screen-assessment');
  renderQuestions();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER QUESTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQuestions() {
  const container = document.getElementById('questions-container');
  container.innerHTML = '';
  let qNum = 1;
  questions.forEach(q => {
    if (q.section) {
      const div = document.createElement('div');
      div.className = 'section-divider';
      div.innerHTML = `<div class="section-divider-label ${q.sectionAccent?'accent':''}">${q.section}</div><div class="section-divider-line"></div>`;
      container.appendChild(div);
    }
    const card = document.createElement('div');
    card.className = 'q-card'; card.id = `card-${q.id}`;
    let html = `<div class="q-number">Q${qNum} of 40 &nbsp;Â·&nbsp; ${typeLabel(q.type)}</div><div class="q-text">${q.q}</div>`;
    if (q.type==='mc') {
      html += `<div class="options-grid">`+q.options.map((o,i)=>
        `<button class="option-btn" id="opt-${q.id}-${i}" onclick="selectMC('${q.id}',${i})">
          <div class="option-letter">${String.fromCharCode(65+i)}</div><span>${o}</span></button>`
      ).join('')+`</div>`+checkBtnHtml(q.id);
    } else if (q.type==='tf') {
      html += `<div class="tf-grid">
        <button class="tf-btn" id="tf-${q.id}-true" onclick="selectTF('${q.id}',true)">âœ“ True</button>
        <button class="tf-btn" id="tf-${q.id}-false" onclick="selectTF('${q.id}',false)">âœ— False</button>
      </div>`+checkBtnHtml(q.id);
    } else if (q.type==='fill') {
      html += `<input class="fill-input" id="fill-${q.id}" placeholder="Type your answer hereâ€¦" onkeydown="if(event.key==='Enter')checkFill('${q.id}')">
               <button class="check-btn" onclick="checkFill('${q.id}')">Check Answer</button>`;
    } else if (q.type==='written') {
      html += `<div class="written-label">âœï¸ Written Response <span class="badge-manual">Manual Grading</span></div>
               <textarea class="written-area" id="written-${q.id}" placeholder="${q.placeholder}" oninput="saveWritten('${q.id}')"></textarea>`;
    }
    html += `<div class="q-feedback" id="feedback-${q.id}"></div>`;
    card.innerHTML = html;
    container.appendChild(card);
    qNum++;
  });
  updateProgress();
}
function typeLabel(t){return{mc:'Multiple Choice',tf:'True / False',fill:'Fill in the Blank',written:'Written Response'}[t];}
function checkBtnHtml(id){return `<button class="check-btn" id="chk-${id}" onclick="checkAnswer('${id}')" disabled>Check Answer</button>`;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INTERACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectMC(id,idx){
  if(checked[id])return;
  userAnswers[id]=idx;
  const q=getQ(id);
  q.options.forEach((_,i)=>document.getElementById(`opt-${id}-${i}`).classList.toggle('selected',i===idx));
  document.getElementById(`chk-${id}`).disabled=false;
  updateProgress();
}
function selectTF(id,val){
  if(checked[id])return;
  userAnswers[id]=val;
  document.getElementById(`tf-${id}-true`).classList.toggle('selected',val===true);
  document.getElementById(`tf-${id}-false`).classList.toggle('selected',val===false);
  document.getElementById(`chk-${id}`).disabled=false;
  updateProgress();
}
function checkAnswer(id){
  if(checked[id])return;
  const q=getQ(id); const ua=userAnswers[id];
  if(ua===undefined)return;
  checked[id]=true;
  const correct=(q.type==='mc')?ua===q.answer:ua===q.answer;
  autoTotal++; if(correct)autoScore++;
  document.getElementById(`card-${id}`).classList.add(correct?'correct':'incorrect');
  if(q.type==='mc'){
    q.options.forEach((_,i)=>{
      const btn=document.getElementById(`opt-${id}-${i}`); btn.disabled=true;
      if(i===q.answer)btn.classList.add('correct-ans');
      else if(i===ua&&!correct)btn.classList.add('wrong-ans');
      else btn.classList.remove('selected');
    });
  } else {
    ['true','false'].forEach(v=>{document.getElementById(`tf-${id}-${v}`).disabled=true;});
    document.getElementById(`tf-${id}-${q.answer}`).classList.add('correct-ans');
    if(!correct)document.getElementById(`tf-${id}-${ua}`).classList.add('wrong-ans');
  }
  const chk=document.getElementById(`chk-${id}`);
  chk.disabled=true; chk.textContent=correct?'âœ“ Correct!':'âœ— Incorrect';
  chk.style.background=correct?'var(--green)':'var(--red)';
  showFeedback(id,correct,q.feedback);
  updateProgress();
}
function checkFill(id){
  if(checked[id])return;
  const q=getQ(id); const input=document.getElementById(`fill-${id}`);
  const val=input.value.trim().toLowerCase(); const ans=q.answer.toLowerCase();
  const correct=val===ans||val.includes(ans)||ans.includes(val);
  checked[id]=true; autoTotal++; if(correct)autoScore++;
  input.disabled=true; input.classList.add(correct?'correct':'incorrect');
  document.getElementById(`card-${id}`).classList.add(correct?'correct':'incorrect');
  const btn=input.nextElementSibling; btn.disabled=true;
  btn.textContent=correct?`âœ“ Correct! (${q.answer})`:`âœ— Incorrect â€” Answer: ${q.answer}`;
  btn.style.background=correct?'var(--green)':'var(--red)';
  showFeedback(id,correct,q.feedback); updateProgress();
}
function saveWritten(id){
  userAnswers[id]=document.getElementById(`written-${id}`).value;
  document.getElementById(`card-${id}`).classList.toggle('answered',userAnswers[id].trim().length>0);
  updateProgress();
}
function showFeedback(id,correct,text){
  const el=document.getElementById(`feedback-${id}`);
  el.className=`q-feedback show ${correct?'correct-fb':'incorrect-fb'}`;
  el.innerHTML=`<strong>${correct?'âœ“ Well done!':'âœ— Not quite.'}</strong> ${text}`;
}
function updateProgress(){
  const checkedCount=Object.keys(checked).length;
  const writtenFilled=questions.filter(q=>q.type==='written'&&userAnswers[q.id]?.trim()).length;
  const pct=Math.min(Math.round((checkedCount+writtenFilled)/questions.length*100),100);
  document.getElementById('progress-fill').style.width=pct+'%';
  document.getElementById('progress-text').textContent=pct+'% Complete';
  document.getElementById('score-live').textContent=`Auto-score: ${autoScore} / ${autoTotal} graded`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function submitAssessment(){
  questions.forEach(q=>{
    if(q.type!=='written'&&userAnswers[q.id]!==undefined&&!checked[q.id]){
      if(q.type==='fill')checkFill(q.id); else checkAnswer(q.id);
    }
  });
  showScreen('screen-results');
  buildResults();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESULTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildResults(){
  const name=document.getElementById('trainee-name').value.trim()||'VA Trainee';
  const now=new Date();
  document.getElementById('result-name').textContent=name;
  document.getElementById('result-date').textContent=now.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'});
  const pct=autoTotal>0?Math.round(autoScore/autoTotal*100):0;
  document.getElementById('score-pct').textContent=pct+'%';
  document.getElementById('stat-correct').textContent=autoScore;
  document.getElementById('stat-wrong').textContent=autoTotal-autoScore;
  document.getElementById('score-ring').style.background=`conic-gradient(var(--sky) ${pct*3.6}deg, rgba(255,255,255,0.08) 0deg)`;
  document.getElementById('result-heading').textContent=pct>=80?'Great Work! ğŸ‰':pct>=65?'Good Effort!':'Keep Studying!';

  const writtenQs=questions.filter(q=>q.type==='written');
  const area=document.getElementById('manual-grading-area');
  area.innerHTML='';
  writtenQs.forEach((q,i)=>{
    const resp=(userAnswers[q.id]||'').trim()||'<em style="color:var(--gray-mid)">No response entered.</em>';
    area.innerHTML+=`
      <div class="manual-q" id="mq-${q.id}">
        <div class="manual-q-label">Written Q${i+1}</div>
        <div class="manual-q-text">${q.q}</div>
        <div class="manual-q-response">${resp.replace(/\n/g,'<br>')}</div>
        <details style="margin-bottom:12px;">
          <summary style="font-size:13px;color:var(--sky-dark);cursor:pointer;font-weight:600;">ğŸ“ Grading Guidance</summary>
          <p style="font-size:13px;color:var(--gray-mid);margin-top:8px;line-height:1.6;">${q.guidance}</p>
        </details>
        <div class="grade-row">
          <span class="grade-label">Self-grade:</span>
          <button class="grade-btn pass"    onclick="setGrade('${q.id}','pass',this)">âœ“ Pass (10)</button>
          <button class="grade-btn partial" onclick="setGrade('${q.id}','partial',this)">~ Partial (5)</button>
          <button class="grade-btn fail"    onclick="setGrade('${q.id}','fail',this)">âœ— Fail (0)</button>
        </div>
        <input class="grade-note-input" placeholder="Optional notesâ€¦" id="gnote-${q.id}" oninput="gradeNotes['${q.id}']=this.value">
      </div>`;
  });
  submissionId='sub_'+Date.now();
}
function setGrade(id,grade,btn){
  manualGrades[id]=grade;
  btn.closest('.grade-row').querySelectorAll('.grade-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}
function calcFinalScore(){
  const writtenQs=questions.filter(q=>q.type==='written');
  let mPts=0;
  writtenQs.forEach(q=>{if(manualGrades[q.id]==='pass')mPts+=10;else if(manualGrades[q.id]==='partial')mPts+=5;});
  const totalPts=autoScore+mPts; const maxPts=autoTotal+(writtenQs.length*10);
  const finalPct=Math.round(totalPts/maxPts*100);
  const grade=finalPct>=90?'Excellent':finalPct>=80?'Proficient':finalPct>=65?'Developing':'Needs Review';
  document.getElementById('final-score-display').classList.add('show');
  document.getElementById('final-pct').textContent=finalPct+'%';
  document.getElementById('final-detail').textContent=`${totalPts}/${maxPts} pts Â· ${autoScore}/${autoTotal} auto + ${mPts}/${writtenQs.length*10} written Â· ${grade}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SAVE TO GOOGLE SHEETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function saveResults(){
  if(resultsSaved)return;
  const scriptUrl=getScriptUrl();
  if(!scriptUrl){
    alert('Google Sheets is not connected yet. Please complete the setup first (Admin â†’ Setup).');
    return;
  }
  const btn=document.getElementById('save-btn');
  btn.className='save-results-btn saving'; btn.textContent='â³ Submittingâ€¦'; btn.disabled=true;

  const name=document.getElementById('trainee-name').value.trim()||'VA Trainee';
  const now=new Date();
  const writtenQs=questions.filter(q=>q.type==='written');

  // Build answer map
  const answers={};
  questions.forEach(q=>{
    if(q.type!=='written'){
      let ua=userAnswers[q.id];
      let correct=null;
      if(checked[q.id]){
        if(q.type==='fill'){
          const v=(ua||'').toLowerCase(); const a=q.answer.toLowerCase();
          correct=v===a||v.includes(a)||a.includes(v);
        } else { correct=ua===q.answer; }
      }
      answers[q.id]={
        question:q.q.replace(/<[^>]*>/g,''),
        type:q.type, userAnswer:ua,
        correct, correctAnswer:q.answer,
        options:q.options||null
      };
    } else {
      answers[q.id]={
        question:q.q.replace(/<[^>]*>/g,''),
        type:'written', userAnswer:userAnswers[q.id]||'',
        grade:manualGrades[q.id]||null,
        gradeNote:gradeNotes[q.id]||'',
        guidance:q.guidance
      };
    }
  });

  const payload={
    action:'submit', id:submissionId, name,
    dateDisplay:now.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'}),
    autoScore, autoTotal, answers
  };

  try {
    const url=scriptUrl+'?action=submit&data='+encodeURIComponent(JSON.stringify(payload));
    const res=await fetch(url,{redirect:'follow'});
    const text=await res.text();
    const data=JSON.parse(text);
    if(data.ok){
      btn.className='save-results-btn saved'; btn.textContent='âœ… Results Saved to Admin Dashboard!';
      resultsSaved=true;
    } else {
      throw new Error(data.error||'Unknown error');
    }
  } catch(err){
    btn.className='save-results-btn error'; btn.textContent='âŒ Error â€” tap to retry';
    btn.disabled=false;
    btn.onclick=saveResults;
    console.error('Save error:',err);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goAdminLogin(){
  document.getElementById('admin-pw').value='';
  document.getElementById('admin-error').textContent='';
  showScreen('screen-admin-login');
}
function tryAdminLogin(){
  if(document.getElementById('admin-pw').value===ADMIN_PASSWORD){
    document.getElementById('admin-error').textContent='';
    document.getElementById('header-badge').textContent='Admin Dashboard';
    showScreen('screen-admin');
    loadAdminData();
  } else {
    const inp=document.getElementById('admin-pw');
    inp.classList.add('error'); setTimeout(()=>inp.classList.remove('error'),400);
    document.getElementById('admin-error').textContent='Incorrect password. Please try again.';
  }
}
function adminLogout(){
  document.getElementById('header-badge').textContent='VA Training Assessment';
  showScreen('screen-intro');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN DASHBOARD â€” Load from Google Sheets
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminData(){
  const scriptUrl=getScriptUrl();
  const statusEl=document.getElementById('admin-sync-status');
  const listEl=document.getElementById('submissions-list');

  if(!scriptUrl){
    statusEl.innerHTML=`<div class="sync-status disconnected">âš ï¸ Not connected â€” <a href="#" onclick="showSetupFromAdmin()" style="color:inherit;font-weight:700;">complete setup</a> to view submissions</div>`;
    listEl.innerHTML=`<div class="no-submissions"><div class="icon">ğŸ”Œ</div>Google Sheets not connected. Open Setup to configure.</div>`;
    document.getElementById('admin-summary-row').innerHTML=summaryHTML('â€”','â€”','â€”','â€”');
    return;
  }

  statusEl.innerHTML=`<div class="sync-status loading">â³ Loading submissionsâ€¦</div>`;
  const btn=document.getElementById('refresh-btn');
  btn.classList.add('spinning'); btn.disabled=true;

  try {
    const url=`${scriptUrl}?action=getAll`;
    const res=await fetch(url,{redirect:'follow'});
    const text=await res.text();
    const data=JSON.parse(text);
    if(!data.ok) throw new Error(data.error);

    statusEl.innerHTML=`<div class="sync-status connected">âœ… Connected to Google Sheets Â· Last refreshed ${new Date().toLocaleTimeString()}</div>`;
    renderAdminDashboard(data.submissions||[]);
  } catch(err){
    statusEl.innerHTML=`<div class="sync-status disconnected">âŒ Could not reach Google Sheets â€” check your Script URL in Setup</div>`;
    listEl.innerHTML=`<div class="no-submissions"><div class="icon">âš ï¸</div>Could not load data. Check the Setup guide and make sure your Web App is deployed correctly.</div>`;
    document.getElementById('admin-summary-row').innerHTML=summaryHTML('â€”','â€”','â€”','â€”');
  } finally {
    btn.classList.remove('spinning'); btn.disabled=false;
  }
}

function summaryHTML(total,graded,pending,avg){
  return `
    <div class="admin-stat sky"><div class="av">${total}</div><div class="al">Total Submissions</div></div>
    <div class="admin-stat grn"><div class="av">${graded}</div><div class="al">Fully Graded</div></div>
    <div class="admin-stat gold"><div class="av">${pending}</div><div class="al">Pending Review</div></div>
    <div class="admin-stat"><div class="av">${avg}</div><div class="al">Avg Auto-Score</div></div>`;
}

function renderAdminDashboard(subs){
  const writtenQs=questions.filter(q=>q.type==='written');
  const total=subs.length;
  const graded=subs.filter(s=>s.status&&s.status.includes('Graded')).length;
  const pending=total-graded;
  const avgAuto=total?Math.round(subs.reduce((a,s)=>{
    const p=parseInt(s.autoPct)||0; return a+p;},0)/total)+'%':'â€”';
  document.getElementById('admin-summary-row').innerHTML=summaryHTML(total,graded,pending,avgAuto);

  const list=document.getElementById('submissions-list');
  if(!total){
    list.innerHTML=`<div class="no-submissions"><div class="icon">ğŸ“­</div>No submissions yet. Results will appear here once VAs complete and save their assessments.</div>`;
    return;
  }
  list.innerHTML='';
  subs.forEach(sub=>{
    const autoPctNum=parseInt(sub.autoPct)||0;
    const isGraded=sub.status&&sub.status.includes('Graded');
    const pillClass=!isGraded?'pending':autoPctNum>=80?'high':autoPctNum>=65?'mid':'low';
    const pillText=isGraded?(sub.finalPct||sub.autoPct):'Needs Grading';

    const row=document.createElement('div');
    row.className='submission-row'; row.id=`subrow-${sub.id}`;
    row.innerHTML=`
      <div><div class="sub-name">${esc(sub.name)}</div><div class="sub-date">${esc(sub.dateDisplay)}</div></div>
      <div class="sub-scores">
        <span class="score-pill ${pillClass}">${esc(String(pillText))}</span>
        <span class="expand-icon">â–¾</span>
      </div>`;
    row.addEventListener('click',()=>toggleDetail(sub.id));
    list.appendChild(row);

    const detail=document.createElement('div');
    detail.className='submission-detail'; detail.id=`subdetail-${sub.id}`;
    detail.innerHTML=buildDetailHtml(sub);
    list.appendChild(detail);
  });
}

function buildDetailHtml(sub){
  const writtenQs=questions.filter(q=>q.type==='written');
  const writtenPts=parseInt(sub.writtenPts)||0;
  const writtenMax=parseInt(sub.writtenMax)||50;
  const totalPts=(parseInt(sub.autoScore)||0)+writtenPts;
  const maxPts=(parseInt(sub.autoTotal)||0)+writtenMax;

  // Auto answers summary
  let ansRows='';
  const autoQs=questions.filter(q=>q.type!=='written');
  autoQs.forEach(q=>{
    const ans=sub.autoAnswers&&sub.autoAnswers[q.id];
    if(!ans){ansRows+=`<div class="answer-item skip"><span class="answer-icon">â€”</span><div><div class="answer-qtext">${q.q.replace(/<[^>]*>/g,'').substring(0,80)}â€¦</div><div class="answer-given">Not answered</div></div></div>`;return;}
    const isCorr=ans.result&&ans.result.includes('âœ…');
    const isIncr=ans.result&&ans.result.includes('âŒ');
    ansRows+=`
      <div class="answer-item ${isCorr?'corr':isIncr?'incr':'skip'}">
        <span class="answer-icon">${ans.result||'â€”'}</span>
        <div>
          <div class="answer-qtext">${q.q.replace(/<[^>]*>/g,'').substring(0,80)}â€¦</div>
          <div class="answer-given">Answered: <strong>${esc(String(ans.userAnswer||'â€”'))}</strong>${isIncr?` Â· Correct: ${esc(String(ans.correctAnswer||''))}`:''}</div>
        </div>
      </div>`;
  });

  // Written grading
  let writtenRows='';
  writtenQs.forEach((q,i)=>{
    const wa=sub.writtenAnswers&&sub.writtenAnswers[q.id];
    const resp=wa?.userAnswer||'';
    const currentGrade=wa?.grade||'';
    const currentNote=wa?.gradeNote||'';
    const gradeKey=currentGrade.includes('Pass')?'pass':currentGrade.includes('Partial')?'partial':currentGrade.includes('Fail')?'fail':'';
    writtenRows+=`
      <div class="admin-written-q">
        <div class="admin-wq-label">Written Q${i+1}</div>
        <div class="admin-wq-text">${q.q.replace(/<[^>]*>/g,'')}</div>
        <div class="admin-wq-resp">${resp?esc(resp).replace(/\n/g,'<br>'):'<em>No response entered.</em>'}</div>
        <details style="margin-bottom:10px;">
          <summary style="font-size:12px;color:var(--sky-dark);cursor:pointer;font-weight:600;">ğŸ“ Grading Guidance</summary>
          <div class="detail-guidance" style="margin-top:8px;">${q.guidance}</div>
        </details>
        <div class="admin-grade-row">
          <span class="grade-label">Grade:</span>
          <button class="grade-btn pass    ${gradeKey==='pass'?'active':''}"    onclick="adminSetGrade('${sub.id}','${q.id}','pass',this)">âœ“ Pass (10)</button>
          <button class="grade-btn partial ${gradeKey==='partial'?'active':''}" onclick="adminSetGrade('${sub.id}','${q.id}','partial',this)">~ Partial (5)</button>
          <button class="grade-btn fail    ${gradeKey==='fail'?'active':''}"    onclick="adminSetGrade('${sub.id}','${q.id}','fail',this)">âœ— Fail (0)</button>
        </div>
        <input class="admin-grade-note" id="admnote-${sub.id}-${q.id}" placeholder="Feedback notes (optional)â€¦" value="${esc(currentNote)}" oninput="adminNoteInput('${sub.id}','${q.id}',this.value)">
      </div>`;
  });

  return `
    <div class="detail-grid">
      <div class="detail-stat"><div class="dv">${sub.autoScore}/${sub.autoTotal}</div><div class="dl">Auto-Graded Score</div></div>
      <div class="detail-stat"><div class="dv">${writtenPts}/${writtenMax}</div><div class="dl">Written Score</div></div>
      <div class="detail-stat"><div class="dv">${totalPts}/${maxPts}</div><div class="dl">Total Points</div></div>
      <div class="detail-stat"><div class="dv">${sub.finalPct||'Pending'}</div><div class="dl">Final Grade</div></div>
    </div>
    <div class="detail-section-title">Auto-Graded Answers</div>
    <div class="answer-list">${ansRows}</div>
    <div class="detail-section-title" style="margin-top:24px;">Written Responses â€” Grade Here</div>
    ${writtenRows}
    <button class="admin-save-grades-btn" id="admsavebtn-${sub.id}" onclick="adminSaveGrades('${sub.id}')">ğŸ’¾ Save Grades to Sheet</button>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN GRADING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const pendingGrades={};
const pendingNotes={};

function adminSetGrade(subId,qId,grade,btn){
  if(!pendingGrades[subId])pendingGrades[subId]={};
  pendingGrades[subId][qId]=grade;
  btn.closest('.admin-grade-row').querySelectorAll('.grade-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const sb=document.getElementById(`admsavebtn-${subId}`);
  sb.classList.remove('saved'); sb.textContent='ğŸ’¾ Save Grades to Sheet';
}
function adminNoteInput(subId,qId,val){
  if(!pendingNotes[subId])pendingNotes[subId]={};
  pendingNotes[subId][qId]=val;
}
async function adminSaveGrades(subId){
  const scriptUrl=getScriptUrl();
  if(!scriptUrl){alert('Google Sheets not connected. Please complete setup first.');return;}
  const btn=document.getElementById(`admsavebtn-${subId}`);
  btn.disabled=true; btn.textContent='â³ Savingâ€¦';
  const payload={
    action:'saveGrades', id:subId,
    grades:pendingGrades[subId]||{},
    notes:pendingNotes[subId]||{}
  };
  try {
    const url=scriptUrl+'?action=saveGrades&data='+encodeURIComponent(JSON.stringify(payload));
    const res=await fetch(url,{redirect:'follow'});
    const text=await res.text();
    const data=JSON.parse(text);
    if(data.ok){
      btn.classList.add('saved'); btn.textContent='âœ… Grades Saved!'; btn.disabled=false;
      setTimeout(()=>loadAdminData(),1200);
    } else { throw new Error(data.error); }
  } catch(err){
    btn.textContent='âŒ Error saving â€” retry'; btn.disabled=false; console.error(err);
  }
}

function toggleDetail(id){
  const row=document.getElementById(`subrow-${id}`);
  const det=document.getElementById(`subdetail-${id}`);
  const isOpen=det.classList.contains('open');
  document.querySelectorAll('.submission-detail').forEach(d=>d.classList.remove('open'));
  document.querySelectorAll('.submission-row').forEach(r=>r.classList.remove('open'));
  if(!isOpen){row.classList.add('open');det.classList.add('open');}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getQ(id){return questions.find(q=>String(q.id)===String(id));}
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}
function esc(str){
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
